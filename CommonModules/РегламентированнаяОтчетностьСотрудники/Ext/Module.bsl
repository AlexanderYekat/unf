#Область ПрограммныйИнтерфейс

///////////////////////////////////////////////////////////////////////////////
// ФУНКЦИИ ДЛЯ РАБОТЫ С РЕГЛАМЕНТИРОВАННОЙ ОТЧЕТНОСТЬЮ ПО СОТРУДНИКАМ


Функция ВыполнитьРасчетВзносовИНалоговПоСотрудникам(Организация,ПериодРасчета, СобытиеКалендаря, ТринадцатыйПериод = Ложь) Экспорт
	
	ДатаНачалаОбязательногоПримененияЕНП = РегламентированнаяОтчетностьУСН.ДатаОбязательногоПримененияЕНП();
	
	СтруктураРасчета = Новый Структура(
	"Организация,
	|СобытиеКалендаря,
	|ПериодОтчетности,
	|НДФЛСотрудники,
	|НДФЛСвышеПредельнойВеличины,
	|ПФРПоСуммарномуТарифу,
	|ПФРНакопительнаяСотрудники,
	|ПФРСтраховаяСотрудники,
	|ФСССотрудники,
	|ФССТравматизмСотрудники,
	|ФОМССотрудники,
	|ВидВзаиморасчетовСБюджетом,
	|СуммаВзаиморасчетовСБюджетом,
	|ДокументВзаиморасчетовСБюджетом,
	|СуммаНалога",
	Организация,
	СобытиеКалендаря,
	ПериодРасчета,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	Справочники.ВидыНалогов.ПустаяСсылка(),
	0,
	Неопределено,
	0);
	
	Запрос = Новый Запрос;
	Если ПериодРасчета > ДатаНачалаОбязательногоПримененияЕНП 
		И ПолучитьФункциональнуюОпцию("ИспользоватьКадровыйУчет")
		И ПериодРасчета < '20230701'Тогда
		Запрос.Текст = "ВЫБРАТЬ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаПриход КАК НДФЛ,
		|	0 КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	0,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаПриход
		|ИЗ
		|	РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК НДФЛ,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПериодаНДФЛ И &ОкончаниеПериодаНДФЛ
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Активность
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ИсчисленныеСтраховыеВзносыОбороты.ПФРДоПредельнойВеличиныОборот КАК ПФРПоСуммарномуТарифуОборот,
		|	ИсчисленныеСтраховыеВзносыОбороты.ПФРНакопительнаяОборот КАК ПФРНакопительнаяОборот,
		|	ИсчисленныеСтраховыеВзносыОбороты.ПФРСтраховаяОборот КАК ПФРСтраховаяОборот,
		|	ИсчисленныеСтраховыеВзносыОбороты.ФФОМСОборот КАК ФФОМСОборот,
		|	ИсчисленныеСтраховыеВзносыОбороты.ФССОборот КАК ФССОборот,
		|	ИсчисленныеСтраховыеВзносыОбороты.ФССНесчастныеСлучаиОборот КАК ФССНесчастныеСлучаиОборот
		|ИЗ
		|	РегистрНакопления.ИсчисленныеСтраховыеВзносы.Обороты(&НачалоПериода, &ОкончаниеПериода, , Организация = &Организация) КАК ИсчисленныеСтраховыеВзносыОбороты";
		
	ИначеЕсли ПериодРасчета > ДатаНачалаОбязательногоПримененияЕНП 
		И ПолучитьФункциональнуюОпцию("ИспользоватьКадровыйУчет")
		И ПериодРасчета > '20230701'Тогда
		Запрос.Текст = "ВЫБРАТЬ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаПриход КАК НДФЛ,
		|	0 КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	0,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаПриход
		|ИЗ
		|	РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК НДФЛ,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПериодаНДФЛ И &ОкончаниеПериодаНДФЛ
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Активность
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация";
	Иначе
		Запрос.Текст = "ВЫБРАТЬ
		|	НДФЛНалогОбороты.СуммаПриход КАК НДФЛ,
		|	НДФЛНалогОбороты.СуммаСПревышенияПриход КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.НДФЛРасчетыНалоговыхАгентовСБюджетом.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК НДФЛНалогОбороты
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.Сумма КАК НДФЛ,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.СуммаСПревышения КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.Период МЕЖДУ &НачалоПериодаНДФЛ И &ОкончаниеПериодаНДФЛ
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.Активность
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.Организация = &Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРПоСуммарномуТарифу)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРПоСуммарномуТарифуОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРНакопительная)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРНакопительнаяОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРСтраховая)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРСтраховаяОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФФОМС)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФФОМСОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФСС)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФССОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФССНесчастныеСлучаи)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФССНесчастныеСлучаиОборот
		|ИЗ
		|	РегистрНакопления.РасчетыСФондамиПоСтраховымВзносамУНФ.Обороты(&НачалоПериода, &ОкончаниеПериода, , Организация = &Организация) КАК РасчетыСФондамиПоСтраховымВзносамОбороты";
	КонецЕсли;
	
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоМесяца(ПериодРасчета));
	Запрос.УстановитьПараметр("ОкончаниеПериода", КонецМесяца(ПериодРасчета));
	Запрос.УстановитьПараметр("ДатаОкончанияРасчетаНДФЛПоДатеНачисления", ДатаНачалаОбязательногоПримененияЕНП - 1);  
	
	
	Если ПериодРасчета >= ДатаНачалаОбязательногоПримененияЕНП Тогда  
		
		Период = СобытиеКалендаря.ДатаОкончанияДокументов;
		ВводНачальныхДанных = Ложь;
		
		Если ВводНачальныхДанных Тогда
			ПериодЗаполнения = НачалоДня(Период) - 1;
		Иначе
			ПериодЗаполнения = Период;
		КонецЕсли;
		
		ДатаОтноситсяКТринадцатомуПериоду = НачалоДня(Период) >= Дата(Год(ПериодЗаполнения), 12, 23);
		ДатаОтноситсяКоВторойПоловинеМесяца = Ложь;
		Если Период >= '20240101' Тогда
			ДатаОтноситсяКоВторойПоловинеМесяца = НачалоДня(Период) >= Дата(Год(ПериодЗаполнения), Месяц(ПериодЗаполнения), 23);
		КонецЕсли;
		
		ВтораяПоловинаМесяца = ДатаОтноситсяКТринадцатомуПериоду Или ДатаОтноситсяКоВторойПоловинеМесяца;
		
		// Федеральный закон от 31.07.2023 № 389-ФЗ:
		// 12.2. В течение 2023 года налоговые агенты могут подавать уведомления об исчисленных суммах по налогу на доходы физических лиц, 
		// подлежащему перечислению в сроки, установленные пунктом 6 статьи 226, пунктом 9 статьи 226.1, пунктом 7 статьи 226.2 Налогового кодекса Российской Федерации, 
		// до истечения 12-го числа текущего месяца, указав в таком уведомлении сумму налога, 
		// удержанную в период с 23-го числа предыдущего месяца до 9-го числа текущего месяца.
		НачалоПериодаПодачиПромежуточныхУведомлений = НачалоДня(Дата(2023, 10, 1));
		КонецПериодаПодачиПромежуточныхУведомлений = КонецДня(Дата(2023, 12, 31));
		
		Если ВтораяПоловинаМесяца Тогда // 23 число - конец месяца
			ДатаНачалаОтбора    = Дата(Год(Период), Месяц(Период), 23);
			ДатаОкончанияОтбора = КонецМесяца(Период);
			ПоследнийПериод = КонецМесяца(Период) = КонецГода(Период);
		ИначеЕсли НачалоМесяца(Период) = НачалоГода(Период) Тогда // Январь
			ДатаНачалаОтбора    = НачалоГода(Период);
			ДатаОкончанияОтбора = Дата(Год(Период), Месяц(Период), 22);
		ИначеЕсли Период >= НачалоПериодаПодачиПромежуточныхУведомлений 
			И Период <= КонецПериодаПодачиПромежуточныхУведомлений 
			И День(Период) >= 9 И День(Период) < 23 Тогда
			ДатаНачалаОтбора    = Дата(Год(Период), Месяц(Период)-1, 23);
			ДатаОкончанияОтбора = Дата(Год(Период), Месяц(Период), 9);
		ИначеЕсли Период < '20240101' Тогда // остальные периоды 2023 г.
			ДатаНачалаОтбора    = Дата(Год(Период), Месяц(Период)-1, 23);
			ДатаОкончанияОтбора = Дата(Год(Период), Месяц(Период), 22);
		Иначе // остальные периоды 2024 г.
			ДатаНачалаОтбора    = Дата(Год(Период), Месяц(Период), 1);
			ДатаОкончанияОтбора = Дата(Год(Период), Месяц(Период), 22);
		КонецЕсли;  
	Иначе
		ДатаНачалаОтбора    = НачалоМесяца(ПериодРасчета);
		ДатаОкончанияОтбора = КонецМесяца(ПериодРасчета)
	КонецЕсли;  
	
	Запрос.УстановитьПараметр("НачалоПериодаНДФЛ", ДатаНачалаОтбора);
	Запрос.УстановитьПараметр("ОкончаниеПериодаНДФЛ", ДатаОкончанияОтбора);
	
	Пакет = Запрос.ВыполнитьПакет();
	
	// НДфЛ
	СтруктураРасчета.НДФЛСотрудники = 0;
	СтруктураРасчета.НДФЛСвышеПредельнойВеличины = 0;
	
	Выборка = Пакет[0].Выбрать();
	Если Выборка.Следующий() Тогда
		СтруктураРасчета.НДФЛСотрудники = Выборка.НДФЛ;
		СтруктураРасчета.НДФЛСвышеПредельнойВеличины = Выборка.НДФЛСПревышения;
	КонецЕсли;
	
	Выборка = Пакет[1].Выбрать();
	Пока Выборка.Следующий() Цикл
		СтруктураРасчета.НДФЛСотрудники = СтруктураРасчета.НДФЛСотрудники + Выборка.НДФЛ;
		СтруктураРасчета.НДФЛСвышеПредельнойВеличины = СтруктураРасчета.НДФЛСвышеПредельнойВеличины + Выборка.НДФЛСПревышения;
	КонецЦикла;           
	
	Если ПериодРасчета < '20230701' Тогда
		
		Выборка = Пакет[2].Выбрать();
		Если Выборка.Следующий() Тогда
			Если Год(ПериодРасчета) > 2013 Тогда
				СтруктураРасчета.ПФРСтраховаяСотрудники = Выборка.ПФРПоСуммарномуТарифуОборот;
			Иначе
				СтруктураРасчета.ПФРСтраховаяСотрудники = Выборка.ПФРСтраховаяОборот;
			КонецЕсли;
			СтруктураРасчета.ПФРНакопительнаяСотрудники = Выборка.ПФРНакопительнаяОборот;
			СтруктураРасчета.ФСССотрудники = Выборка.ФССОборот;
			СтруктураРасчета.ФОМССотрудники = Выборка.ФФОМСОборот;
			СтруктураРасчета.ФССТравматизмСотрудники = Выборка.ФССНесчастныеСлучаиОборот;
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Организация) Тогда
		СистемаНалогообложения = РегистрыСведений.СистемыНалогообложенияОрганизаций.ОпределитьСистемуНалогообложенияОрганизации(
		Организация, ТекущаяДатаСеанса()); 
		Если СистемаНалогообложения.ПрименяетсяАУСН И ПериодРасчета < '20230701' Тогда
			Запрос = Новый Запрос;
			Запрос.УстановитьПараметр("ДатаСреза", ПериодРасчета);
			Запрос.Текст =
			"ВЫБРАТЬ
			|	РазмерФиксированныхВзносовОтНесчастныхСлучаевАУСНСрезПоследних.Размер КАК Размер
			|ИЗ
			|	РегистрСведений.РазмерФиксированныхВзносовОтНесчастныхСлучаевАУСН.СрезПоследних(&ДатаСреза, ) КАК РазмерФиксированныхВзносовОтНесчастныхСлучаевАУСНСрезПоследних";
			
			Результат = Запрос.Выполнить().Выгрузить();
			Если Результат.Количество() = 0 Тогда
				Размер = 0;
			Иначе
				Размер = Результат[0].Размер;
			КонецЕсли;
			
			МесячныйРазмерВзноса = Окр(Размер / 12, 2); 
			
			СтруктураРасчета.ФССТравматизмСотрудники = МесячныйРазмерВзноса;
			
			СтруктураРасчета.ПФРСтраховаяСотрудники = 0; СтруктураРасчета.ПФРСтраховаяСотрудники = 0;
			СтруктураРасчета.ФСССотрудники = 0; СтруктураРасчета.ФОМССотрудники = 0;	
		КонецЕсли;
		
	КонецЕсли;
	
	НачатьТранзакцию();
	
	СтруктураРасчета.СуммаНалога = СтруктураРасчета.НДФЛСотрудники+
	        СтруктураРасчета.НДФЛСвышеПредельнойВеличины+
			СтруктураРасчета.ПФРСтраховаяСотрудники+
			СтруктураРасчета.ПФРНакопительнаяСотрудники+
			СтруктураРасчета.ФСССотрудники+
			СтруктураРасчета.ФОМССотрудники+
			СтруктураРасчета.ФССТравматизмСотрудники;
	
		// запись состояние события календаря
	Если СобытиеКалендаря <> Неопределено Тогда
		
		КалендарьОтчетности.ЗаписатьСостояниеСобытияКалендаря(
			Организация,
			СобытиеКалендаря,
			Перечисления.СостоянияСобытийКалендаря.Ознакомиться,
			"",
			СтруктураРасчета.СуммаНалога);
			
		
	КонецЕсли;
	РегламентированнаяОтчетностьУСН.ОтразитьЗначенияПоказателейОтчетности(СтруктураРасчета);
	
	
	ЗафиксироватьТранзакцию();
	
	Возврат СтруктураРасчета;
	
КонецФункции    

///////////////////////////////////////////////////////////////////////////////
// ФУНКЦИИ ДЛЯ РАБОТЫ С РЕГЛАМЕНТИРОВАННОЙ ОТЧЕТНОСТЬЮ ПО СОТРУДНИКАМ


Функция ВыполнитьРасчетВзносовПоСотрудникам(Организация,ПериодРасчета, СобытиеКалендаря, ТринадцатыйПериод = Ложь) Экспорт
	
	ДатаНачалаОбязательногоПримененияЕНП = РегламентированнаяОтчетностьУСН.ДатаОбязательногоПримененияЕНП();
	
	СтруктураРасчета = Новый Структура(
	"Организация,
	|СобытиеКалендаря,
	|ПериодОтчетности,
	|ПФРПоСуммарномуТарифу,
	|ПФРНакопительнаяСотрудники,
	|ПФРСтраховаяСотрудники,
	|ФСССотрудники,
	|ФССТравматизмСотрудники,
	|ФОМССотрудники,
	|ВидВзаиморасчетовСБюджетом,
	|СуммаВзаиморасчетовСБюджетом,
	|ДокументВзаиморасчетовСБюджетом,
	|СуммаНалога",
	Организация,
	СобытиеКалендаря,
	ПериодРасчета,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	Справочники.ВидыНалогов.ПустаяСсылка(),
	0,
	Неопределено,
	0);
	
	Запрос = Новый Запрос;
	Если ПериодРасчета > ДатаНачалаОбязательногоПримененияЕНП 
		И ПолучитьФункциональнуюОпцию("ИспользоватьКадровыйУчет") Тогда
		Запрос.Текст = "ВЫБРАТЬ
		               |	ИсчисленныеСтраховыеВзносыОбороты.ПФРДоПредельнойВеличиныОборот КАК ПФРПоСуммарномуТарифуОборот,
		               |	ИсчисленныеСтраховыеВзносыОбороты.ПФРНакопительнаяОборот КАК ПФРНакопительнаяОборот,
		               |	ИсчисленныеСтраховыеВзносыОбороты.ПФРСтраховаяОборот КАК ПФРСтраховаяОборот,
		               |	ИсчисленныеСтраховыеВзносыОбороты.ФФОМСОборот КАК ФФОМСОборот,
		               |	ИсчисленныеСтраховыеВзносыОбороты.ФССОборот КАК ФССОборот,
		               |	ИсчисленныеСтраховыеВзносыОбороты.ФССНесчастныеСлучаиОборот КАК ФССНесчастныеСлучаиОборот
		               |ИЗ
		               |	РегистрНакопления.ИсчисленныеСтраховыеВзносы.Обороты(&НачалоПериода, &ОкончаниеПериода, , Организация = &Организация) КАК ИсчисленныеСтраховыеВзносыОбороты";
	Иначе
		Запрос.Текст = "ВЫБРАТЬ
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРПоСуммарномуТарифу)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРПоСуммарномуТарифуОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРНакопительная)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРНакопительнаяОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРСтраховая)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРСтраховаяОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФФОМС)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФФОМСОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФСС)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФССОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФССНесчастныеСлучаи)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФССНесчастныеСлучаиОборот
		|ИЗ
		|	РегистрНакопления.РасчетыСФондамиПоСтраховымВзносамУНФ.Обороты(&НачалоПериода, &ОкончаниеПериода, , Организация = &Организация) КАК РасчетыСФондамиПоСтраховымВзносамОбороты";
	КонецЕсли;
	
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоМесяца(ПериодРасчета));
	Запрос.УстановитьПараметр("ОкончаниеПериода", КонецМесяца(ПериодРасчета));
	
	Пакет = Запрос.ВыполнитьПакет();
	
	Выборка = Пакет[0].Выбрать();
	Если Выборка.Следующий() Тогда
		Если Год(ПериодРасчета) > 2013 Тогда
			СтруктураРасчета.ПФРСтраховаяСотрудники = Выборка.ПФРПоСуммарномуТарифуОборот;
		Иначе
			СтруктураРасчета.ПФРСтраховаяСотрудники = Выборка.ПФРСтраховаяОборот;
		КонецЕсли;
		СтруктураРасчета.ПФРНакопительнаяСотрудники = Выборка.ПФРНакопительнаяОборот;
		СтруктураРасчета.ФСССотрудники = Выборка.ФССОборот;
		СтруктураРасчета.ФОМССотрудники = Выборка.ФФОМСОборот;
		СтруктураРасчета.ФССТравматизмСотрудники = Выборка.ФССНесчастныеСлучаиОборот;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Организация) Тогда
		СистемаНалогообложения = РегистрыСведений.СистемыНалогообложенияОрганизаций.ОпределитьСистемуНалогообложенияОрганизации(
		Организация, ТекущаяДатаСеанса()); 
		Если СистемаНалогообложения.ПрименяетсяАУСН Тогда
			Запрос = Новый Запрос;
			Запрос.УстановитьПараметр("ДатаСреза", ПериодРасчета);
			Запрос.Текст =
			"ВЫБРАТЬ
			|	РазмерФиксированныхВзносовОтНесчастныхСлучаевАУСНСрезПоследних.Размер КАК Размер
			|ИЗ
			|	РегистрСведений.РазмерФиксированныхВзносовОтНесчастныхСлучаевАУСН.СрезПоследних(&ДатаСреза, ) КАК РазмерФиксированныхВзносовОтНесчастныхСлучаевАУСНСрезПоследних";
			
			Результат = Запрос.Выполнить().Выгрузить();
			Если Результат.Количество() = 0 Тогда
				Размер = 0;
			Иначе
				Размер = Результат[0].Размер;
			КонецЕсли;
			
			МесяцРасчета = Месяц(ПериодРасчета);
			
			МесячныйРазмерВзноса = 0;
			ВзносыЗаПредыдущиеМесяцы = 0;
			
			Для Месяц = 1 По МесяцРасчета Цикл
				РазмерВзносаСНачалаГода = Окр(Размер * Месяц / 12, 2);
				МесячныйРазмерВзноса = РазмерВзносаСНачалаГода - ВзносыЗаПредыдущиеМесяцы;
				ВзносыЗаПредыдущиеМесяцы = ВзносыЗаПредыдущиеМесяцы + МесячныйРазмерВзноса;
			КонецЦикла;
					
			СтруктураРасчета.ФССТравматизмСотрудники = МесячныйРазмерВзноса;
			
			СтруктураРасчета.ПФРСтраховаяСотрудники = 0; СтруктураРасчета.ПФРСтраховаяСотрудники = 0;
			СтруктураРасчета.ФСССотрудники = 0; СтруктураРасчета.ФОМССотрудники = 0;	
		КонецЕсли;
		
	КонецЕсли;
	
	НачатьТранзакцию();
	
	Если День(СобытиеКалендаря.ДатаОкончанияСобытия) > 20 Тогда
		СтруктураРасчета.СуммаНалога = СтруктураРасчета.ПФРСтраховаяСотрудники+
		СтруктураРасчета.ПФРНакопительнаяСотрудники+
		СтруктураРасчета.ФСССотрудники+
		СтруктураРасчета.ФОМССотрудники;
	Иначе
		 СтруктураРасчета.СуммаНалога =	СтруктураРасчета.ФССТравматизмСотрудники;
	КонецЕсли;
	
	// запись состояние события календаря
	Если СобытиеКалендаря <> Неопределено Тогда
		
		КалендарьОтчетности.ЗаписатьСостояниеСобытияКалендаря(
		Организация,
		СобытиеКалендаря,
		Перечисления.СостоянияСобытийКалендаря.Ознакомиться,
		"",
		СтруктураРасчета.СуммаНалога);   	
		
	КонецЕсли;
	РегламентированнаяОтчетностьУСН.ОтразитьЗначенияПоказателейОтчетности(СтруктураРасчета); 
	
	ЗафиксироватьТранзакцию();
	
	Возврат СтруктураРасчета;
	
КонецФункции


Процедура ВыполнитьРасчетВзносовИНалоговПоСотрудникамПредварительный(Организация,ПериодРасчета, ДатаДокументаОбработкиСобытия, ЗаписьСобытия, ТринадцатыйПериод = Ложь) Экспорт
	
	ДатаНачалаОбязательногоПримененияЕНП = РегламентированнаяОтчетностьУСН.ДатаОбязательногоПримененияЕНП();
	
	Запрос = Новый Запрос;
	Если ПериодРасчета > ДатаНачалаОбязательногоПримененияЕНП 
		И ПолучитьФункциональнуюОпцию("ИспользоватьКадровыйУчет")
		И ПериодРасчета < '20230701'Тогда
		Запрос.Текст = "ВЫБРАТЬ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаПриход КАК НДФЛ,
		|	0 КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	0,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаПриход
		|ИЗ
		|	РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК НДФЛ,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПериодаНДФЛ И &ОкончаниеПериодаНДФЛ
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Активность
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ПФРДоПредельнойВеличиныОборот, 0) КАК ПФРПоСуммарномуТарифуОборот,
		|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ПФРНакопительнаяОборот, 0) КАК ПФРНакопительнаяОборот,
		|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ПФРСтраховаяОборот, 0) КАК ПФРСтраховаяОборот,
		|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ФФОМСОборот, 0) КАК ФФОМСОборот,
		|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ФССОборот, 0) КАК ФССОборот,
		|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ФССНесчастныеСлучаиОборот, 0) КАК ФССНесчастныеСлучаиОборот
		|ИЗ
		|	РегистрНакопления.ИсчисленныеСтраховыеВзносы.Обороты(&НачалоПериода, &ОкончаниеПериода, , Организация = &Организация) КАК ИсчисленныеСтраховыеВзносыОбороты";
		
	ИначеЕсли ПериодРасчета > ДатаНачалаОбязательногоПримененияЕНП 
		И ПолучитьФункциональнуюОпцию("ИспользоватьКадровыйУчет")
		И ПериодРасчета > '20230701'Тогда
		Запрос.Текст = "ВЫБРАТЬ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаПриход КАК НДФЛ,
		|	0 КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка13)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	0,
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.СуммаПриход
		|ИЗ
		|	РегистрНакопления.РасчетыНалоговыхАгентовСБюджетомПоНДФЛ.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты
		|ГДЕ
		|	РасчетыНалоговыхАгентовСБюджетомПоНДФЛОбороты.Ставка = ЗНАЧЕНИЕ(Перечисление.НДФЛСтавки.Ставка15)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Сумма КАК НДФЛ,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.СуммаСПревышения КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Период МЕЖДУ &НачалоПериодаНДФЛ И &ОкончаниеПериодаНДФЛ
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Активность
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛ.Организация = &Организация";
	Иначе
		Запрос.Текст = "ВЫБРАТЬ
		|	НДФЛНалогОбороты.СуммаПриход КАК НДФЛ,
		|	НДФЛНалогОбороты.СуммаСПревышенияПриход КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.НДФЛРасчетыНалоговыхАгентовСБюджетом.Обороты(&НачалоПериода, &ДатаОкончанияРасчетаНДФЛПоДатеНачисления, , Организация = &Организация) КАК НДФЛНалогОбороты
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.Сумма КАК НДФЛ,
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.СуммаСПревышения КАК НДФЛСПревышения
		|ИЗ
		|	РегистрНакопления.РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ КАК РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ
		|ГДЕ
		|	РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.ВариантУдержания = ЗНАЧЕНИЕ(Перечисление.ВариантыУдержанияНДФЛ.Удержано)
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.Период МЕЖДУ &НачалоПериодаНДФЛ И &ОкончаниеПериодаНДФЛ
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.Активность
		|	И РасчетыНалогоплательщиковСБюджетомПоНДФЛУНФ.Организация = &Организация
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРПоСуммарномуТарифу)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРПоСуммарномуТарифуОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРНакопительная)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРНакопительнаяОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРСтраховая)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРСтраховаяОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФФОМС)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФФОМСОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФСС)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФССОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФССНесчастныеСлучаи)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФССНесчастныеСлучаиОборот
		|ИЗ
		|	РегистрНакопления.РасчетыСФондамиПоСтраховымВзносамУНФ.Обороты(&НачалоПериода, &ОкончаниеПериода, , Организация = &Организация) КАК РасчетыСФондамиПоСтраховымВзносамОбороты";
	КонецЕсли;
	
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоМесяца(ПериодРасчета));
	Запрос.УстановитьПараметр("ОкончаниеПериода", КонецМесяца(ПериодРасчета));
	Запрос.УстановитьПараметр("ДатаОкончанияРасчетаНДФЛПоДатеНачисления", ДатаНачалаОбязательногоПримененияЕНП - 1);  
	
	
	Если ПериодРасчета >= ДатаНачалаОбязательногоПримененияЕНП Тогда    
		
		Период = ЗаписьСобытия.СобытиеКалендаря.ДатаОкончанияДокументов;
		ВводНачальныхДанных = Ложь;
		
		Если ВводНачальныхДанных Тогда
			ПериодЗаполнения = НачалоДня(Период) - 1;
		Иначе
			ПериодЗаполнения = Период;
		КонецЕсли;
		
		ДатаОтноситсяКТринадцатомуПериоду = НачалоДня(Период) >= Дата(Год(ПериодЗаполнения), 12, 23);
		ДатаОтноситсяКоВторойПоловинеМесяца = Ложь;
		Если Период >= '20240101' Тогда
			ДатаОтноситсяКоВторойПоловинеМесяца = НачалоДня(Период) >= Дата(Год(ПериодЗаполнения), Месяц(ПериодЗаполнения), 23);
		КонецЕсли;
		
		ВтораяПоловинаМесяца = ДатаОтноситсяКТринадцатомуПериоду Или ДатаОтноситсяКоВторойПоловинеМесяца;
		
		// Федеральный закон от 31.07.2023 № 389-ФЗ:
		// 12.2. В течение 2023 года налоговые агенты могут подавать уведомления об исчисленных суммах по налогу на доходы физических лиц, 
		// подлежащему перечислению в сроки, установленные пунктом 6 статьи 226, пунктом 9 статьи 226.1, пунктом 7 статьи 226.2 Налогового кодекса Российской Федерации, 
		// до истечения 12-го числа текущего месяца, указав в таком уведомлении сумму налога, 
		// удержанную в период с 23-го числа предыдущего месяца до 9-го числа текущего месяца.
		НачалоПериодаПодачиПромежуточныхУведомлений = НачалоДня(Дата(2023, 10, 1));
		КонецПериодаПодачиПромежуточныхУведомлений = КонецДня(Дата(2023, 12, 31));
		
		Если ВтораяПоловинаМесяца Тогда // 23 число - конец месяца
			ДатаНачалаОтбора    = Дата(Год(Период), Месяц(Период), 23);
			ДатаОкончанияОтбора = КонецМесяца(Период);
			ПоследнийПериод = КонецМесяца(Период) = КонецГода(Период);
		ИначеЕсли НачалоМесяца(Период) = НачалоГода(Период) Тогда // Январь
			ДатаНачалаОтбора    = НачалоГода(Период);
			ДатаОкончанияОтбора = Дата(Год(Период), Месяц(Период), 22);
		ИначеЕсли Период >= НачалоПериодаПодачиПромежуточныхУведомлений 
			И Период <= КонецПериодаПодачиПромежуточныхУведомлений 
			И День(Период) >= 9 И День(Период) < 23 Тогда
			ДатаНачалаОтбора    = Дата(Год(Период), Месяц(Период)-1, 23);
			ДатаОкончанияОтбора = Дата(Год(Период), Месяц(Период), 9);
		ИначеЕсли Период < '20240101' Тогда // остальные периоды 2023 г.
			ДатаНачалаОтбора    = Дата(Год(Период), Месяц(Период)-1, 23);
			ДатаОкончанияОтбора = Дата(Год(Период), Месяц(Период), 22);
		Иначе // остальные периоды 2024 г.
			ДатаНачалаОтбора    = Дата(Год(Период), Месяц(Период), 1);
			ДатаОкончанияОтбора = Дата(Год(Период), Месяц(Период), 22);
		КонецЕсли;   
	Иначе
		НачалоПериодаУплаты    = НачалоМесяца(ПериодРасчета);
		ОкончаниеПериодаУплаты = КонецМесяца(ПериодРасчета)
	КонецЕсли;
	Запрос.УстановитьПараметр("НачалоПериодаНДФЛ", ДатаНачалаОтбора);
	Запрос.УстановитьПараметр("ОкончаниеПериодаНДФЛ", ДатаОкончанияОтбора);
	
	Пакет = Запрос.ВыполнитьПакет();
	Выборка = Пакет[0].Выбрать();
	
	НДФЛСотрудники = 0;
	НДФЛСвышеПредельнойВеличины = 0;

	Если Выборка.Следующий() Тогда
		НДФЛСотрудники = Выборка.НДФЛ;
		НДФЛСвышеПредельнойВеличины = Выборка.НДФЛСПревышения;  
	КонецЕсли;   
	
	Выборка = Пакет[1].Выбрать();
	Пока Выборка.Следующий() Цикл
		НДФЛСотрудники = НДФЛСотрудники + Выборка.НДФЛ;
		НДФЛСвышеПредельнойВеличины = НДФЛСвышеПредельнойВеличины + Выборка.НДФЛСПревышения;
	КонецЦикла;  
	
	Если ПериодРасчета < '20230701' Тогда		
		Выборка = Пакет[2].Выбрать(); 			
		Если Выборка.Следующий() Тогда
			Если Год(ПериодРасчета) > 2013 Тогда
				ПФРСтраховаяСотрудники = Выборка.ПФРПоСуммарномуТарифуОборот;
			Иначе
				ПФРСтраховаяСотрудники = Выборка.ПФРСтраховаяОборот;
			КонецЕсли;
			ПФРНакопительнаяСотрудники = Выборка.ПФРНакопительнаяОборот;
			ФСССотрудники = Выборка.ФССОборот;
			ФОМССотрудники = Выборка.ФФОМСОборот;
			ФССТравматизмСотрудники = Выборка.ФССНесчастныеСлучаиОборот; 
		Иначе
			ПФРСтраховаяСотрудники = 0;
			ПФРНакопительнаяСотрудники = 0;
			ФСССотрудники = 0;
			ФОМССотрудники = 0;
		    ФССТравматизмСотрудники = 0;	
		КонецЕсли;
	КонецЕсли; 
	
	НачатьТранзакцию();
	
		// запись состояние события календаря
	Если ЗаписьСобытия <> Неопределено Тогда
		
		СуммаЗаПредыдущиеПериоды = РегламентированнаяОтчетностьУСН.ПредварительнаяСуммаНалогаЗаПредыдущиеПериоды(Организация, Справочники.ЗадачиКалендаряПодготовкиОтчетности.НалогиСотрудников, НачалоМесяца(Период));
		СобытиеКалендаряОбъект = ЗаписьСобытия.ПолучитьОбъект();
		
		Если ПериодРасчета < '20230701' Тогда
		СобытиеКалендаряОбъект.СуммаНалога = 
			НДФЛСотрудники+
			НДФЛСвышеПредельнойВеличины+
			ПФРСтраховаяСотрудники+
			ПФРНакопительнаяСотрудники+
			ФСССотрудники+
			ФОМССотрудники+
			ФССТравматизмСотрудники;  
		Иначе
			СобытиеКалендаряОбъект.СуммаНалога = 
			НДФЛСотрудники+
			НДФЛСвышеПредельнойВеличины;
		КонецЕсли;
		
		СобытиеКалендаряОбъект.СуммаНалога = ?(СобытиеКалендаряОбъект.СуммаНалога - СуммаЗаПредыдущиеПериоды > 0, СобытиеКалендаряОбъект.СуммаНалога - СуммаЗаПредыдущиеПериоды, 0);;
 		КалендарьОтчетности.ЗаписатьСобытиеКалендаря(СобытиеКалендаряОбъект);
		
		ЗафиксироватьТранзакцию();
	КонецЕсли;
	
КонецПроцедуры    

Процедура ВыполнитьРасчетВзносовПоСотрудникамПредварительный(Организация,ПериодРасчета, ДатаДокументаОбработкиСобытия, ЗаписьСобытия, ТринадцатыйПериод = Ложь) Экспорт
	
	ДатаНачалаОбязательногоПримененияЕНП = РегламентированнаяОтчетностьУСН.ДатаОбязательногоПримененияЕНП();
	
		Запрос = Новый Запрос;
		Если ПериодРасчета > ДатаНачалаОбязательногоПримененияЕНП 
			И ПолучитьФункциональнуюОпцию("ИспользоватьКадровыйУчет") Тогда
			Запрос.Текст = "ВЫБРАТЬ
			|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ПФРДоПредельнойВеличиныОборот, 0) КАК ПФРПоСуммарномуТарифуОборот,
			|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ПФРНакопительнаяОборот, 0) КАК ПФРНакопительнаяОборот,
			|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ПФРСтраховаяОборот, 0) КАК ПФРСтраховаяОборот,
			|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ФФОМСОборот, 0) КАК ФФОМСОборот,
			|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ФССОборот, 0) КАК ФССОборот,
			|	ЕСТЬNULL(ИсчисленныеСтраховыеВзносыОбороты.ФССНесчастныеСлучаиОборот, 0) КАК ФССНесчастныеСлучаиОборот
			|ИЗ
			|	РегистрНакопления.ИсчисленныеСтраховыеВзносы.Обороты(&НачалоПериода, &ОкончаниеПериода, , Организация = &Организация) КАК ИсчисленныеСтраховыеВзносыОбороты";
		Иначе
		Запрос.Текст = "ВЫБРАТЬ
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРПоСуммарномуТарифу)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРПоСуммарномуТарифуОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРНакопительная)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРНакопительнаяОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ПФРСтраховая)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ПФРСтраховаяОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФФОМС)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФФОМСОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФСС)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФССОборот,
		|	ЕСТЬNULL(СУММА(ВЫБОР
		|				КОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.ВидОбязательногоСтрахованияСотрудников = ЗНАЧЕНИЕ(Перечисление.ВидыОбязательногоСтрахованияСотрудниковУНФ.ФССНесчастныеСлучаи)
		|					ТОГДА РасчетыСФондамиПоСтраховымВзносамОбороты.СуммаПриход
		|				ИНАЧЕ 0
		|			КОНЕЦ), 0) КАК ФССНесчастныеСлучаиОборот
		|ИЗ
		|	РегистрНакопления.РасчетыСФондамиПоСтраховымВзносамУНФ.Обороты(&НачалоПериода, &ОкончаниеПериода, , Организация = &Организация) КАК РасчетыСФондамиПоСтраховымВзносамОбороты";
	КонецЕсли;
	
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоМесяца(ПериодРасчета));
	Запрос.УстановитьПараметр("ОкончаниеПериода", КонецМесяца(ПериодРасчета));
	
	Пакет = Запрос.ВыполнитьПакет();
	
	Выборка = Пакет[0].Выбрать();
	Если Выборка.Следующий() Тогда
		Если Год(ПериодРасчета) > 2013 Тогда
			ПФРСтраховаяСотрудники = Выборка.ПФРПоСуммарномуТарифуОборот;
		Иначе
			ПФРСтраховаяСотрудники = Выборка.ПФРСтраховаяОборот;
		КонецЕсли;
		ПФРНакопительнаяСотрудники = Выборка.ПФРНакопительнаяОборот;
		ФСССотрудники = Выборка.ФССОборот;
		ФОМССотрудники = Выборка.ФФОМСОборот;
		ФССТравматизмСотрудники = Выборка.ФССНесчастныеСлучаиОборот; 
	Иначе
		ПФРСтраховаяСотрудники = 0; 
		ПФРНакопительнаяСотрудники = 0;
		ФСССотрудники = 0;
		ФОМССотрудники = 0;
		ФССТравматизмСотрудники = 0;	
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Организация) Тогда
		СистемаНалогообложения = РегистрыСведений.СистемыНалогообложенияОрганизаций.ОпределитьСистемуНалогообложенияОрганизации(
		Организация, ТекущаяДатаСеанса()); 
		Если СистемаНалогообложения.ПрименяетсяАУСН Тогда
			Запрос = Новый Запрос;
			Запрос.УстановитьПараметр("ДатаСреза", ПериодРасчета);
			Запрос.Текст =
			"ВЫБРАТЬ
			|	РазмерФиксированныхВзносовОтНесчастныхСлучаевАУСНСрезПоследних.Размер КАК Размер
			|ИЗ
			|	РегистрСведений.РазмерФиксированныхВзносовОтНесчастныхСлучаевАУСН.СрезПоследних(&ДатаСреза, ) КАК РазмерФиксированныхВзносовОтНесчастныхСлучаевАУСНСрезПоследних";
			
			Результат = Запрос.Выполнить().Выгрузить();
			Если Результат.Количество() = 0 Тогда
				Размер = 0;
			Иначе
				Размер = Результат[0].Размер;
			КонецЕсли;
			
			МесяцРасчета = Месяц(ПериодРасчета);
			
			МесячныйРазмерВзноса = 0;
			ВзносыЗаПредыдущиеМесяцы = 0;
			
			Для Месяц = 1 По МесяцРасчета Цикл
				РазмерВзносаСНачалаГода = Окр(Размер * Месяц / 12, 2);
				МесячныйРазмерВзноса = РазмерВзносаСНачалаГода - ВзносыЗаПредыдущиеМесяцы;
				ВзносыЗаПредыдущиеМесяцы = ВзносыЗаПредыдущиеМесяцы + МесячныйРазмерВзноса;
			КонецЦикла;
			
			ФССТравматизмСотрудники = МесячныйРазмерВзноса;
			
			ПФРСтраховаяСотрудники = 0; 
			ПФРНакопительнаяСотрудники = 0;
			ФСССотрудники = 0;
			ФОМССотрудники = 0;
			
		КонецЕсли;
		
	КонецЕсли;     
	

	НачатьТранзакцию(); 
	
	// запись состояние события календаря
	Если ЗаписьСобытия <> Неопределено Тогда
		
		СобытиеКалендаряОбъект = ЗаписьСобытия.ПолучитьОбъект();
		
		Если СистемаНалогообложения.ПрименяетсяАУСН Тогда
			СобытиеКалендаряОбъект.СуммаНалога =  МесячныйРазмерВзноса;
			
		Иначе	
			СуммаЗаПредыдущиеПериоды = РегламентированнаяОтчетностьУСН.ПредварительнаяСуммаНалогаЗаПредыдущиеПериоды(Организация, Справочники.ЗадачиКалендаряПодготовкиОтчетности.СтраховыеВзносыЗаСотрудников, ДатаДокументаОбработкиСобытия);
			
			Если День(ЗаписьСобытия.СобытиеКалендаря.ДатаОкончанияСобытия) > 20 Тогда		
				СобытиеКалендаряОбъект.СуммаНалога = 
				ПФРСтраховаяСотрудники+
				ПФРНакопительнаяСотрудники+
				ФСССотрудники+
				ФОМССотрудники;
			Иначе      
				СобытиеКалендаряОбъект.СуммаНалога = 
				ФССТравматизмСотрудники;			
			КонецЕсли;
			
			СобытиеКалендаряОбъект.СуммаНалога = ?(СобытиеКалендаряОбъект.СуммаНалога - СуммаЗаПредыдущиеПериоды > 0, СобытиеКалендаряОбъект.СуммаНалога - СуммаЗаПредыдущиеПериоды, 0);;
			КалендарьОтчетности.ЗаписатьСобытиеКалендаря(СобытиеКалендаряОбъект);	
		КонецЕсли;
		
		ЗафиксироватьТранзакцию();
	КонецЕсли;
	
КонецПроцедуры


Функция ВыполнитьПроверкуНаличияДокументовПоЗарплатеСотрудников(Организация,ПериодРасчета) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	НачислениеЗарплатыУНФ.Ссылка КАК Ссылка,
	|	НачислениеЗарплатыУНФ.ПериодРегистрации КАК ПериодРегистрации,
	|	НачислениеЗарплатыУНФ.Организация КАК Организация
	|ИЗ
	|	Документ.НачислениеЗарплатыУНФ КАК НачислениеЗарплатыУНФ
	|ГДЕ
	|	НачислениеЗарплатыУНФ.Организация = &Организация
	|	И НачислениеЗарплатыУНФ.ПериодРегистрации МЕЖДУ &НачалоКвартала И &КонецКвартала
	|
	|УПОРЯДОЧИТЬ ПО
	|	НачислениеЗарплатыУНФ.ПериодРегистрации";
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("НачалоКвартала",НачалоКвартала(ПериодРасчета));
	Запрос.УстановитьПараметр("КонецКвартала",КонецКвартала(ПериодРасчета));
	Выборка = Запрос.Выполнить().Выбрать();
	
	МассивДат = Новый Массив;
	Пока Выборка.Следующий() Цикл
		МассивДат.Добавить(НачалоМесяца(Выборка.ПериодРегистрации));
	КонецЦикла;
	
	ТекстПустыхМесяцев = "";
	НачальнаяДата = НачалоКвартала(ПериодРасчета);
	Для инд = 0 По 2 Цикл
		Если МассивДат.Найти(ДобавитьМесяц(НачальнаяДата, инд)) <> Неопределено Тогда
			ТекстПустыхМесяцев = ТекстПустыхМесяцев + ?(ПустаяСтрока(ТекстПустыхМесяцев),"",", ")+Формат(ДобавитьМесяц(НачальнаяДата, инд), "ДФ=MMMM");
		КонецЕсли;
	КонецЦикла;
	
	Если ПустаяСтрока(ТекстПустыхМесяцев) Тогда 
		Возврат Новый Структура("ДокументыВНаличии, ТекстУведомления",Истина,"");
	Иначе
		Возврат Новый Структура("ДокументыВНаличии, ТекстУведомления", Ложь,
			НСтр("ru = 'Отсутствуют документы Начисление зарплаты за месяцы:"+ТекстПустыхМесяцев+"
				|Если зарплата в эти месяцы начислялась, необходимо добавить и документы.'"));
	КонецЕсли;
	
КонецФункции

Функция ВыполнитьПроверкуНаличияДокументаПоЗарплатеСотрудниковЗаМесяц(Организация,ПериодРасчета) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	НачислениеЗарплатыУНФ.Ссылка КАК Ссылка,
	|	НачислениеЗарплатыУНФ.ПериодРегистрации КАК ПериодРегистрации,
	|	НачислениеЗарплатыУНФ.Организация КАК Организация
	|ИЗ
	|	Документ.НачислениеЗарплатыУНФ КАК НачислениеЗарплатыУНФ
	|ГДЕ
	|	НачислениеЗарплатыУНФ.Организация = &Организация
	|	И НачислениеЗарплатыУНФ.ПериодРегистрации = &ПериодРегистрации
	|
	|УПОРЯДОЧИТЬ ПО
	|	НачислениеЗарплатыУНФ.ПериодРегистрации";
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("ПериодРегистрации",НачалоМесяца(ПериодРасчета));
	Выборка = Запрос.Выполнить().Выбрать();
	
	Возврат Выборка.Следующий();
	
КонецФункции

Функция ИспользуетсяРегламентированнаяЗарплата(Организация) Экспорт
	
	ГоловнаяОрганизация = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Организация, "ГоловнаяОрганизация"); 
	
	Возврат (ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ГоловнаяОрганизация, "ИспользуетсяОтчетность") = Истина
	И ПолучитьФункциональнуюОпцию("ИспользоватьОтчетность")							
	И ПолучитьФункциональнуюОпцию("ИспользоватьНачислениеЗарплатыДляНебольшихОрганизаций")); 
	
КонецФункции


#КонецОбласти
